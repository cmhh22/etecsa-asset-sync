{% extends "base.html" %}

{% block title %}Reports — ETECSA Asset Sync{% endblock %}
{% block nav_reports %}active{% endblock %}
{% block page_title %}Sync Reports{% endblock %}

{% block content %}
<!-- Sheet Selector & Actions -->
<div class="d-flex flex-wrap justify-content-between align-items-center mb-3 gap-2">
    <div class="d-flex align-items-center gap-3">
        <form method="GET" class="d-flex align-items-center gap-2">
            <label for="sheet" class="form-label mb-0 fw-semibold text-secondary">Sheet:</label>
            <select name="sheet" id="sheet" class="form-select form-select-sm" style="width: 280px;"
                    onchange="this.form.submit()">
                {% for sheet in sheets %}
                    <option value="{{ sheet }}" {% if sheet == selected_sheet %}selected{% endif %}>
                        {{ sheet }}
                    </option>
                {% endfor %}
            </select>
        </form>
        <span class="badge bg-secondary badge-etecsa" id="rowCount">
            {{ rows|length }} records
        </span>
    </div>
    <div class="d-flex gap-2">
        <a href="{% url 'export_reports' %}" class="btn btn-sm btn-outline-primary">
            <i class="bi bi-download me-1"></i> Export Excel
        </a>
        <a href="{% url 'accountinfo' %}" class="btn btn-sm btn-outline-secondary">
            <i class="bi bi-arrow-left me-1"></i> Back
        </a>
    </div>
</div>

<!-- Messages -->
{% if messages %}
<div class="mb-3">
    {% for message in messages %}
    <div class="alert alert-{{ message.tags|default:'info' }} alert-dismissible fade show">
        {{ message }}
        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
    </div>
    {% endfor %}
</div>
{% endif %}

<!-- Sheet Info Cards -->
<div class="row g-3 mb-3">
    <div class="col-auto">
        <div class="d-inline-flex align-items-center gap-2 px-3 py-2 rounded-3"
             style="background: #f0f5ff; border: 1px solid #d0e0f5;">
            <i class="bi bi-file-earmark-spreadsheet text-primary"></i>
            <span class="fw-semibold text-primary">{{ selected_sheet }}</span>
        </div>
    </div>
    <div class="col-auto">
        <div class="d-inline-flex align-items-center gap-2 px-3 py-2 rounded-3"
             style="background: #f5f5f5;">
            <i class="bi bi-grid-3x3 text-secondary"></i>
            <span class="text-secondary">{{ sheets|length }} sheets available</span>
        </div>
    </div>
</div>

<!-- Report Table -->
<div class="card content-card">
    <div class="card-body p-0">
        <div style="max-height: 60vh; overflow-y: auto; border-radius: 8px;">
            <table class="table table-modern table-hover mb-0" id="reportTable">
                <thead>
                    <tr>
                        <th style="width: 40px;">#</th>
                        {% for col in rows.0.keys %}
                            <th>{{ col }}</th>
                        {% endfor %}
                    </tr>
                </thead>
                <tbody>
                    {% for row in rows %}
                    <tr>
                        <td class="text-muted">{{ forloop.counter }}</td>
                        {% for value in row.values %}
                            <td>{{ value|default:"—" }}</td>
                        {% endfor %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="20" class="text-center text-muted py-5">
                            <i class="bi bi-inbox fs-1 d-block mb-2"></i>
                            This sheet has no data
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Update row count on page load
    const rows = document.querySelectorAll('#reportTable tbody tr');
    document.getElementById('rowCount').textContent = `${rows.length} records`;
</script>
{% endblock %}
